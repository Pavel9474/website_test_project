{%extends 'main/layout.html'%}

<body>
    

<main>
    {%block content%} 
    <form action="">
<div>
    <a class="toggle-vis" data-column="0">Название статьи</a> - <a class="toggle-vis" data-column="1">Первый автор</a> - <a class="toggle-vis" data-column="2">Год</a> - <a class="toggle-vis" data-column="3">Детали</a>
</div>
        
    </form>
    <div class="features">
<table id="databones" class="display" style="width:100%">
        <thead >
            <tr>
                <th>Название статьи</th>
                <th>Первый автор</th>
                <th>Год</th>
                <th> </th>
            </tr>
        </thead >
        <tbody>
            <tr>
            {% if table %}
                {% for el in table %}
                    <td>{{el.title}}</td>
                    <td>{{el.first_author}}</td>
                    <td>{{el.year_pub}}</td> 
                    <td><a href="{% url 'databones-detail' el.id %}" class="btn btn-warning">Details</a></td>  
            </tr>   
                {% endfor %}
            {% else %}
                <p> Тут пока что ничего нет </p>
            {% endif %}
        </tbody>
        <tfoot>
            <th>Название статьи</th>
            <th>Первый автор</th>
            <th>Год</th>
        </tfoot>
    </table>
    
</div>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<link href="https://cdn.datatables.net/v/ju/jszip-3.10.1/dt-2.0.3/af-2.7.0/b-3.0.1/b-colvis-3.0.1/b-html5-3.0.1/b-print-3.0.1/fh-4.0.1/rg-1.5.0/sc-2.4.1/sb-1.7.0/sp-2.3.0/sl-2.0.0/datatables.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/v/ju/jszip-3.10.1/dt-2.0.3/af-2.7.0/b-3.0.1/b-colvis-3.0.1/b-html5-3.0.1/b-print-3.0.1/fh-4.0.1/rg-1.5.0/sc-2.4.1/sb-1.7.0/sp-2.3.0/sl-2.0.0/datatables.min.js"></script>
<script>
const table = new DataTable('#databones', {
    initComplete: function () {
        this.api()
            .columns([0,1,2])

            .every(function () {
                let column = this;
                let title = column.header().textContent;
                // Create input element
                let input = document.createElement('input');
                input.placeholder = title;
                column.header().replaceChildren(input);
 
                // Event listener for user input
                input.addEventListener('keyup', () => {
                    if (column.search() !== this.value) {
                        column.search(input.value).draw();
                    }
                });
            });
},

paging: false,
scrollY: '200px',
order: [[ 2, 'desc' ], [ 0, 'asc' ]]
});
document.querySelectorAll('a.toggle-vis').forEach((el) => {
        el.addEventListener('click', function (e) {
        e.preventDefault();
        let columnIdx = e.target.getAttribute('data-column');
        let column = table.column(columnIdx);
         // Toggle the visibility
        column.visible(!column.visible());
    });
});





//     const table = new DataTable('#databones',  {  "columnDefs": [
//         { "searchable": false, "targets": [1,2] }
//     ],
//     initComplete: function () { 
//     document.querySelectorAll('a.toggle-vis').forEach((el) => {
//     el.addEventListener('click', function (e) {
//         e.preventDefault();
//          let columnIdx = e.target.getAttribute('data-column');
//         let column = table.column(columnIdx);
//          // Toggle the visibility
//         column.visible(!column.visible());
//     });
// });
//     $('#databones tfoot th').each( function () {
//     var title = $('#databones tfoot th').eq( $(this).index() ).text();
//     if(title!=""){
//     $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
//       }
//     } );
//     table.columns().eq( 0 ).each( function ( colIdx ) {
//         if( !table.settings()[0].aoColumns[colIdx].bSearchable ){
//         table.column( colIdx ).header().innerHTML=table.column( colIdx ).footer().innerHTML;
//     }
//         $( 'input', table.column( colIdx ).header() ).on( 'keyup change', function () {
//             table
//                 .column( colIdx )
//                 .search( this.value )
//                 .draw();
//         } );
// })},


// searching: false,
// dom: 'Bfrtip',
// buttons: [
//         'copy', 'excel', 'pdf'
//     ]
// });
    </script>
    {% endblock %}
</main>
</body>
